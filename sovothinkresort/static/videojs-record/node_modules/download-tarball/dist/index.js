'use strict';

var _got = require('got');

var _got2 = _interopRequireDefault(_got);

var _pump = require('pump');

var _pump2 = _interopRequireDefault(_pump);

var _tarFs = require('tar-fs');

var _gunzipMaybe = require('gunzip-maybe');

var _gunzipMaybe2 = _interopRequireDefault(_gunzipMaybe);

var _httpHttpsAgent = require('http-https-agent');

var _httpHttpsAgent2 = _interopRequireDefault(_httpHttpsAgent);

var _objectAssign = require('object-assign');

var _objectAssign2 = _interopRequireDefault(_objectAssign);

var _promisifyFunction = require('promisify-function');

var _promisifyFunction2 = _interopRequireDefault(_promisifyFunction);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var getAgent = (0, _httpHttpsAgent2.default)({
  keepAlive: true,
  maxSockets: 20
});

module.exports = (0, _promisifyFunction2.default)(function (_ref, callback) {
  var url = _ref.url,
      gotOpts = _ref.gotOpts,
      extractOpts = _ref.extractOpts,
      dir = _ref.dir;

  (0, _pump2.default)(_got2.default.stream(url, (0, _objectAssign2.default)({ agent: getAgent(url) }, gotOpts)), (0, _gunzipMaybe2.default)(), (0, _tarFs.extract)(dir, extractOpts), callback);
});